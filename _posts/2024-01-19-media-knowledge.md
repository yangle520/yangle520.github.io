---
layout: post
title:  流媒体基础知识
date:   2024-01-15 00:00:00 +0800
categories: 智慧矿山
tag: 学习
---
* content
{:toc}
## 存储介绍

### 流媒体数据存储问题

1、数据量大

2、数据长度可变：由于原始码流的冗余不用，压缩后的多媒体数据的数据量可变，无法估计，因此组织存储比较繁琐，其结构、检索处理都与常规数据不一样

3、多媒体流及同步问题：流媒体的时间连续性要求和媒体间的同步要求，使多媒体数据的检索问题异常复杂，必须保证在限定的时间内得到数据



### 存储介质

![层次存储模型]({{ '/styles/images/层次存储模型.png' | prepend: site.baseurl  }})

层次越高，性能越好；价格越高，存储量越小，持久性越差



### 磁盘知识简介

存储磁盘三大指标：吞吐量、IOPS、时延
吞吐量：网络、设备、端口、虚电路或其他设施，单位时间内成功地传送数据的数量（以比特、字节、分组等测量）
IOPS：（Input/Output Operations Per Second）是一个用于计算机存储设备（如机械硬盘HDD、固态硬盘SSD、混合硬盘HHD或存储区域网络SAN等）性能测试的量测方式，可以视为是每秒的读写次数。
时延：发起读取数据请求到读取到数据之间的时间间隔。

### 存储方式区别

文件、块和对象是三种以不同的方式来保存、整理和呈现数据的存储格式。

| 存储方式     | NAS                                                          | EBS                                                          | OSS                                                          |
| ------------ | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ |
| **说明**     | 文件存储<br />会以文件和文件夹的层次结构来整理和呈现数据     | 块存储<br />将数据拆分到任意划分且大小相同的卷中             | 对象存储<br />会管理数据并将其链接至关联的元数据             |
| **接口协议** | NFS、SMB协议，支持POSIX接口访问                              | 自研协议 （iSCSI）                                           | HTTP/HTTPS<br />支持AWS的S3接口                              |
| **应用场景** | 存储架构是目录树状结构<br />可以支持上千台虚拟机通过POSIX接口同时、高并发访问，支持随机读写、在线修改、直读直写 | 性能高、时延低，适合于OLTP数据库、NoSQL数据库等IO密集型的高性能、低时延应用工作负载，支持随机读写 | 存储架构为S3<br />扁平化文件组织形式，不支持文件随机读写，主要适用于互联网架构的海量数据的上传下载和分发<br />对象和存储段通过统一资源标识符（URI）进行查找 |



------

### 视频带宽计算

码流：视频文件在单位时间内使用的数据流量。单位 Kbps，Mbps。

帧率：1秒钟内传输的图片的帧数。单位 fps。一般视频帧率 25fps左右。

分辨率：视频成像产品所成图像的大小或尺寸。

1. D1：480i格式，720×480 ，水平480线，隔行扫描，行频 15.25kHz
2. D2：480P格式，720×480，水平480线，逐行扫描，行频 31.5kHz
3. D3：1080i格式，1920×1080，水平1080线，隔行扫描，行频 33.75kHz
4. D4：720P格式，1280×720，水平720线，逐行扫描，行频 45kHz
5. D5：1080P格式，1920×1080，水平1080线，逐行扫描，行频 67.5kHz

文件大小 = 时间 × 码流 / 8  。除以8是因为 码流是以bit 为单位的，需要除以8转换成字节。

同时观看人数 = 带宽 / 码流 

摄像头比特率 = 摄像头帧率(fps) * 摄像头分辨率(横像素*纵像素) * 每像素位数/8

```
1080P摄像头比特率约 4Mpbs~6Mpbs，0.5M/S~0.75M/S,一小时视频约1800MB~2700MB
```

摄像头码流 = 图像比特率 + 音频比特率 + 元数据比特率



需要事先将摄像头分组，再为每个摄像头建立目录，确保每组的流量不超过块设备的存储边界



## 流媒体基本概念

**流媒体开发**

1. 网络层(socket/st)负责传输
2. 协议层(rtmp/hls)负责网络打包
3. 封装层负责编解码数据
4. 编码层负责图像/音频压缩

**帧**：静止画面

**GOP**：画面组，一个GOP就是一组连续的画面，每个画面都是一帧，一个GOP就是很多帧的集合

**I帧、P帧、B帧**：https://www.xjx100.cn/news/1372843.html

**码率**：图片进行压缩后每秒显示的数据量

**帧率**：每秒显示的图片数。影响画面流畅度，与画面流畅度成正比：帧率越大，画面越流畅；帧率越小，画面越有跳动感

**分辨率**：(矩形)图片的长度和宽度，即图片的尺寸

**压缩比**：压缩前的每秒数据量/码率

**视频封装格式**：一种储存视频信息的容器，流式封装可以有TS、FLV等，索引式的封装有MP4,MOV,AVI等

**帧内压缩**：当压缩一帧图像时，仅考虑本帧的数据而不考虑相邻帧之间的冗余信息，帧内一般采用有损压缩算法

**帧间压缩**：时间压缩，它通过比较时间轴上不同帧之间的数据进行压缩。帧间压缩一般是无损的

**muxing（合成）**：将视频流、音频流甚至是字幕流封装到一个文件中(容器格式（FLV，TS）)，作为一个信号进行传输



### 视频编码

**MPEG**：一种视频压缩方式，它采用了帧间压缩，仅存储连续帧之间有差别的地方 ，从而达到较大的压缩比

**H.264/AVC**：一种视频压缩方式,采用事先预测和与MPEG中的P-B帧一样的帧预测方法压缩，它可以根据需要产生适合网络情况传输的视频流,还有更高的压缩比，有更好的图象质量

**H.265/HEVC**：一种视频压缩方式,基于H.264，保留原来的某些技术，同时对一些相关的技术加以改进，以改善码流、编码质量、延时和算法复杂度之间的关系，达到最优化设置



### 视频封装

TS：一种流媒体封装格式，流媒体封装有一个好处，就是不需要加载索引再播放，大大减少了首次载入的延迟，如果片子比较长，mp4文件的索引相当大，影响用户体验

FLV：一种流媒体封装格式,由于它形成的文件极小、加载速度极快，使得网络观看视频文件成为可能,因此FLV格式成为了当今主流视频格式

