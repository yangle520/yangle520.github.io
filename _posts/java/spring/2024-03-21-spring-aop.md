---
layout: post
title:  Spring 代理与 AOP
date:   2024-03-21 00:00:00 +0800
categories: 系统设计
tag: 系统设计
---





Spring 代理在支持 AOP 的同时，为 Spring 自身的扩展及对其他框架的融合奠定了非常好的基础。Spring 代理分为两种：JDK 动态代理和 CGLIB 动态代理。JDK 动态代理是 Java 自带的使用反射技术生成一个实现代理接口的匿名类，再执行具体方法前调用 InvokeHandler 进行处理。CGLIB 动态代理是使用 ASM 开源包，将代理对象类的 class 文件加载进来，然后利用字节码技术修改 class 文件的字节码生成子类，进而实现代理类。

OOP（Object Oriented Programming）是一种面向对象的程序设计。对象在显式支持面向对象的语言中，一般指类在内存中装载的实例，具有相关的成员变量和成员函数(也叫方法)。我们通过抽象的方法把对象的共同特性总结出来构造类，主要关心对象包含哪些属性及行为，但是不关心具体的细节，从而达到软件工程的要求：重用性、灵活性和拓展性。

AOP 可以说是 OOP 的补充和完善。OOP 通过引入封装、继承和多态性等概念来建立一种对象的层次结构，用于模拟公共行为的一个集合，但在需要为分散的对象引入公共行为时就显得无能为力了。例如日志功能，因为日志代码往往水平的散布在所有对象的层次中，却与它们所在对象的核心功能毫无关系；以及其他类型如安全性、异常处理等非业务代码。也就是说，OOP允许我们定义从上到下的关系，但并不适合定义从左到右的关系。这种散布在各处的毫无关系的代码被称为横切（cross-cutting）代码。在 OOP 的设计中有大量的重复代码，不利用各模块的重用。在以下场景中更适合使用 AOP ：

1. 组件代码与业务代码解耦。例如 日志功能、事务功能、异常处理、统一拦截、数据提取等。很多开源组件都是利用 AOP 的面向切面编程特性实现零侵入的
2. 代码高度复用、功能可配置。在部分逻辑相同但需要覆盖业务场景比较丰富时，可以先通过定义切面实现通用逻辑，然后把需要实现这部分通用逻辑的业务代码配置在切面范围内。同时，代码可高度复用，当通用逻辑发生变更甚至删除或按配置切换部分过渡代码时，可以进行统一处理，避免漏改、漏配等。



