---
layout: post
title:  redis
date:   2024-08-18
categories: 数据库 NoSQL
tag: 数据库
author: YangLe
excerpt_image: /images/database/redis/redis数据结构.png
---



## 一、Redis 介绍

Redis 全称 Remote Dictionary Server（远程字典服务），是一个开源的使用ANSI C语言编写、支持网络、可基于内存亦可持久化的日志型、Key-Value 数据库，并提供多种语言的API。

Redis的数据是存在内存中的。它的读写速度非常快，每秒可以处理超过10万次读写操作。因此 Redis 被广泛应用于缓存，也经常用来做分布式锁。

Redis 支持事务、持久化、LUA脚本、LRU驱动事件、多种集群方案。



## 二、数据结构类型

**基本类型**：

1. **String** 字符串
   - **简介说明**：最基础的数据结构类型，二进制安全的，可以存储图片或序列化的对象，最大存储512M
   - **应用场景**：共享session、分布式锁、计数器、限流
2. **Hash** 哈希
   - **简介说明**：它的值本身也是一个键值对（k-v）结构
   - **内部编码**：ziplist（压缩列表）、hashtable（哈希表）
   - **应用场景**：缓存用户信息等
   - **注意事项**：使用 hgetall 时，如果哈希元素比较多，可能导致Redis阻塞，可以使用hscan。如果只是获取部分 field，建议使用 hmget。
3. **List** 列表
   - **简介说明**：用来存储多个有序的字符串，一个列表最多可以存储 4294967295 （2^32 - 1）个元素
   - **内部编码**：ziplist（压缩列表）、linkedlist（链表）
   - **应用场景**：消息队列、文章列表
   - **使用组合**：
     - lpush + lpop = Stack (栈)
     - lpush + rpop = Queue (队列)
     - lpush + ltrim = Capped Collection (有限集合)
     - lpush + brpop = Message Queue (消息队列)
4. **Set** 集合
   - **简介说明**：用来保存多个字符串元素，但是不允许重复元素
   - **内部编码**：intset（整数集合）、hashtable（哈希表）
   - **应用场景**：用户标签、生成随机数抽奖、社交需求
   - **注意事项**：smembers、lrange、hgetall 属于比较重的命令、如果元素过多存在阻塞 redis 的可能性，可以使用 sscan 来完成
5. **Zset** 有序集合
   - **简介说明**：已排序的字符串集合，同时元素不能重复
   - **内部编码**：ziplist（压缩列表）、skiplist（跳跃表）
   - **应用场景**：排行榜、社交需求（用户点赞）



**特殊数据结构类型**：

- **Geo**：redis 3.2 推出的，地理位置定位，用于存储地理位置信息，并对存储的信息进行操作
- **HyperLogLog**：用来做基数统计算法的数据结构，如统计网站的UV
- **Bitmap**：用一个比特位来映射某个元素的状态，它的底层是基于字符串类型实现的，可以把 bitmaps 看着一个以比特位为单位的数组



## 三、Redis 命令

### 1、keys

基本语法：COMMAND key_name

| 命令                                      | 描述                                                         | 可用版本 | 返回值                                                       |
| ----------------------------------------- | ------------------------------------------------------------ | -------- | ------------------------------------------------------------ |
| DEL key                                   | 用于删除已存在的键，不存在的key会被忽略                      | >=1.0.0  | 被删除key的数量                                              |
| DUMP key                                  | 序列化给定key，并返回被序列化的值                            | >=2.6.0  | key存在返回序列化后的值<br />不存在返回 nil                  |
| EXISTS key                                | 检查key是否存在                                              | >=1.0.0  | 存在返回1，不存在返回0                                       |
| EXPIRE key seconds                        | 设置key的过期时间，过期后不可再用，单位以秒计                | >=1.0.0  | 成功返回1，失败返回0                                         |
| EXPIREAT key timestamp                    | 以UNIX时间戳格式设置key过期时间                              | >=1.0.0  | 成功返回1，失败返回0                                         |
| PEXPIRE key milliseconds                  | 以毫秒为单位设置key过期时间                                  | >=2.6.0  | 成功返回1，失败返回0                                         |
| PEXPIREAT key millseconds-timestamp       | 以UNIX时间戳格式设置key过期时间（毫秒级）                    | >=1.0.0  | 成功返回1，失败返回0                                         |
| KEYS pattern                              | 查询所有符合给的pattern的key                                 | \>=1.0.0 | 返回key列表(Array)                                           |
| MOVE key db                               | 将当前key移动到给定的数据库db中                              | \>=1.0.0 | 成功返回1，失败返回0                                         |
| PERSIST key                               | 移除key过期时间，使其永不过期                                | >=2.2.0  | 成功返回1，失败返回0                                         |
| PTTL key                                  | 以毫秒为单位返回key的剩余过期时间                            | >=2.6.0  | key不存在 -2<br />存在但没有过期时间 -1<br />其他返回剩余生存时间 |
| TTL key                                   | 以秒为单位返回key剩余过期时间                                | \>=1.0.0 | 同上                                                         |
| RANDOMKEY                                 | 从当前数据库中随机返回一个key                                | \>=1.0.0 | 数据库不为空时，返回一个key<br />为空时，返回 nil            |
| RENAME key newkey                         | 用于修改key的名称，新key已经存在时会覆盖                     | \>=1.0.0 | 改名成功时提升OK，失败时返回一个错误                         |
| RENAMENX key newkey                       | 新key不存在时，修改key的名称                                 | \>=1.0.0 | 成功返回1，新key已经存在时返回0                              |
| SCAN cursor [MATCH pattern] [COUNT count] | cursor 游标，pattern 匹配模式，count 每次返回key的数量，默认10 | >=2.8.0  | 数组列表                                                     |
| TYPE key                                  | 返回key所存储的值的类型                                      | \>=1.0.0 | none (key不存在)<br />string (字符串)<br />list (列表)<br />set (集合)<br />zset (有序集)<br />hash (哈希表) |



### 2、String



### 3、Hash

### 4、List

### 5、Set

### 6、sorted set

### 7、HyperLogLog

### 8、GEO







