---
layout: post
title: Monorepo 
subtitle: Monorepo - 优劣、踩坑、选型
date:   2024-06-13 00:00:00
categories: 前端 架构
tag: 架构
author: YangLe
---







## 一、Monorepo 介绍

Monorepo 是一种项目代码管理方式，只单个仓库中管理多个项目，有助于**简化** **代码共享**、**版本控制**、**构建**、**部署** 等方面的复杂性，并提供更好的可重用性和协作性。Monorepo 提倡了开放、透明、共享的组织文化。



## 二、Monorepo 演进

- 阶段一：**单仓库巨石应用**（Monolith），一个 Git 仓库维护着项目代码，随着迭代业务复杂度的提升，项目代码会变得越来越多，越来越复杂，大量代码构建效率也会降低，最终导致了单体巨石应用。

- 阶段二：**多仓库多模块应用**（MultiRepo），将项目拆解成多个业务模块，并在多个 Git 仓库管理，模块解耦，降低了巨石应用的复杂度，每个模块都可以独立编码、测试、发版，代码管理变得简化，构建效率也得以提升。

- 阶段三：**单仓库多模块应用**（Monorepo），随着业务复杂度的提升，模块仓库越来越多，MultiRepo 的方式虽然从业务上解耦了，但增加了项目工程管理的难道，随着模块仓库达到一定数量级，会有几个问题：

  - 跨仓库代码难共享
  - 分散在单仓库的模块依赖管理复杂（底层模块升级后，其他上层依赖需要及时更新）
  - 增加了构建耗时

  于是将多个项目集成到一个仓库下，共享工程配置，同时又快捷地共享模块代码，成为趋势。

![图片]({{ '/images/design/monorepo/monorepo演进.png' | prepend: site.baseurl }})



## 三、Monorepo 优劣

MultiRepo 与 MonoRepo 对比：

![图片]({{ '/images/design/monorepo/multirepoVSmonorepo.png' | prepend: site.baseurl }})

| 场景       | MultiRepo                                                    | MonoRepo                                                     |
| ---------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 代码可见性 | ✅ 代码隔离，研发只需要关注自己负责的仓库<br />❌包管理按照各自 owner 划分，当出现问题时，需要到依赖包中进行判断并解决 | ✅ 一个仓库中多个相关项目，很容易看到整个代码库的变化趋势，更好的团队写作<br />❌增加了非 owner 改动代码的风险 |
| 依赖管理   | ❌多个仓库都有自己的 node_modules，存在依赖重复安装情况，占用磁盘内存大 | ✅ 多项目代码都在一个仓库中，相同版本依赖提升到顶层只安装依次，节省磁盘内存 |
| 代码权限   | ✅ 各项目单独仓库，不会出现代码被误改的情况，单个项目出现问题不会影响其他项目 | ❌多个项目代码都在一个仓库中，没有项目粒度的权限管控，一个项目出问题，可能影响所有项目 |
| 开发迭代   | ✅ 仓库体积小，模块划分清晰，可维护性强<br />❌多仓库来回切换（编辑器），项目多的话效率很低。多仓库间存在依赖时，需要手段关联，操作繁琐<br />❌依赖管理不便，多个依赖可能在多个仓库中存在不同版本，重复安装，有时会存在依赖冲突 | ✅ 多个项目都在一个仓库中，可看到相关项目全貌，编码非常方便<br />✅ 代码复用高，方便进行代码重构<br />✅ 依赖调试方便，依赖包迭代场景下，借助工具自动关联，直接使用最新版本依赖，简化了操作流程 |
| 工程配置   | ❌各项目构建、打包、代码校验都各自维护，不一致时会导致代码差异 或 构建差异 | ✅ 多项目在一个仓库，工程配置一致，代码质量标准及风格也很容易一致 |
| 构建部署   | ❌多个项目间存在依赖，部署时需要手动到不同的仓库根据先后顺序去修改版本及进行部署，操作繁琐 效率低 | ✅ 构建性 MonoRepo 工具可以配置依赖项目的构建优先级，可以实现一次命令完成所有的部署 |

综合如上 MonoRepo VS MultiRepo，**中大型项目**，**多模块项目**，更适合用 MonoRepo 方式管理代码。在开发、协助效率、代码一致性方面都能收益。



参考博客：https://juejin.cn/post/7215886869199896637

MonoRepo工具选择：https://cloud.tencent.com/developer/article/2397876